---
const currentPath = Astro.url.pathname;
---

<header
  class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-b border-black/10 z-[1000]"
>
  <div class="container">
    <nav class="flex items-center justify-between py-4 gap-8">
      <a
        href="/"
        class="flex flex-col font-serif text-2xl font-bold text-black"
      >
        <span>Linaya</span>
        <span
          class="text-xs font-normal tracking-[0.3em] uppercase text-gold -mt-1"
          >Mariage</span
        >
      </a>

      <ul class="hidden lg:flex list-none gap-10 items-center">
        <li>
          <a
            href="/"
            class={`text-sm font-normal uppercase tracking-wider relative py-2 transition-all duration-300 ${
              currentPath === "/" ? "after:w-full" : "after:w-0"
            } after:content-[''] after:absolute after:bottom-0 after:left-0 after:h-px after:bg-gold after:transition-all after:duration-300 hover:after:w-full`}
          >
            Accueil
          </a>
        </li>
        <li>
          <a
            href="/robes"
            class={`text-sm font-normal uppercase tracking-wider relative py-2 transition-all duration-300 ${
              currentPath === "/robes" ? "after:w-full" : "after:w-0"
            } after:content-[''] after:absolute after:bottom-0 after:left-0 after:h-px after:bg-gold after:transition-all after:duration-300 hover:after:w-full`}
          >
            Nos Robes
          </a>
        </li>
        <li>
          <a
            href="/a-propos"
            class={`text-sm font-normal uppercase tracking-wider relative py-2 transition-all duration-300 ${
              currentPath === "/a-propos" ? "after:w-full" : "after:w-0"
            } after:content-[''] after:absolute after:bottom-0 after:left-0 after:h-px after:bg-gold after:transition-all after:duration-300 hover:after:w-full`}
          >
            À Propos
          </a>
        </li>
        <li>
          <a
            href="/contact"
            class={`text-sm font-normal uppercase tracking-wider relative py-2 transition-all duration-300 ${
              currentPath === "/contact" ? "after:w-full" : "after:w-0"
            } after:content-[''] after:absolute after:bottom-0 after:left-0 after:h-px after:bg-gold after:transition-all after:duration-300 hover:after:w-full`}
          >
            Contact
          </a>
        </li>
      </ul>

      <a
        href="#rdv"
        class="hidden lg:inline-block btn btn-gold btn-small whitespace-nowrap"
      >
        Prendre RDV
      </a>

      <button
        class="mobile-menu-toggle lg:hidden flex flex-col gap-1.5 bg-transparent border-none cursor-pointer p-2 z-[1001] relative"
        aria-label="Menu"
        aria-expanded="false"
        id="mobile-menu-toggle"
      >
        <span
          class="menu-line-1 w-6 h-0.5 bg-black transition-all duration-300 ease-in-out"
        ></span>
        <span
          class="menu-line-2 w-6 h-0.5 bg-black transition-all duration-300 ease-in-out"
        ></span>
        <span
          class="menu-line-3 w-6 h-0.5 bg-black transition-all duration-300 ease-in-out"
        ></span>
      </button>
    </nav>
  </div>
</header>

<div
  class="mobile-menu-overlay lg:hidden fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out z-[1001]"
  id="mobile-menu-overlay"
>
</div>

<div
  class="mobile-menu lg:hidden fixed top-0 right-0 w-80 max-w-[85vw] bg-white shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out z-[1002] overflow-y-auto max-h-screen"
  id="mobile-menu"
>
  <div class="p-6 pt-24 relative">
    <button
      class="mobile-menu-close absolute top-6 right-6 w-8 h-8 flex items-center justify-center bg-transparent border-none cursor-pointer p-0 z-10"
      aria-label="Fermer le menu"
      id="mobile-menu-close"
    >
      <svg
        class="w-6 h-6 text-black"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
    <ul class="list-none space-y-4">
      <li>
        <a
          href="/"
          class={`block text-sm font-normal uppercase tracking-wider py-3 transition-colors duration-200 ${
            currentPath === "/" ? "text-gold" : "text-black"
          } hover:text-gold`}
        >
          Accueil
        </a>
      </li>
      <li>
        <a
          href="/robes"
          class={`block text-sm font-normal uppercase tracking-wider py-3 transition-colors duration-200 ${
            currentPath === "/robes" ? "text-gold" : "text-black"
          } hover:text-gold`}
        >
          Nos Robes
        </a>
      </li>
      <li>
        <a
          href="/a-propos"
          class={`block text-sm font-normal uppercase tracking-wider py-3 transition-colors duration-200 ${
            currentPath === "/a-propos" ? "text-gold" : "text-black"
          } hover:text-gold`}
        >
          À Propos
        </a>
      </li>
      <li>
        <a
          href="/contact"
          class={`block text-sm font-normal uppercase tracking-wider py-3 transition-colors duration-200 ${
            currentPath === "/contact" ? "text-gold" : "text-black"
          } hover:text-gold`}
        >
          Contact
        </a>
      </li>
      <li class="pt-4">
        <a href="#rdv" class="block btn btn-gold btn-small text-center">
          Prendre RDV
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
  function initMobileMenu() {
    const menuToggle = document.getElementById("mobile-menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const mobileMenuOverlay = document.getElementById("mobile-menu-overlay");
    const mobileMenuClose = document.getElementById("mobile-menu-close");
    const menuLine1 = menuToggle?.querySelector(".menu-line-1");
    const menuLine2 = menuToggle?.querySelector(".menu-line-2");
    const menuLine3 = menuToggle?.querySelector(".menu-line-3");
    const body = document.body;

    if (!menuToggle || !mobileMenu || !mobileMenuOverlay) return;

    function closeMenu() {
      if (!mobileMenu || !mobileMenuOverlay || !menuToggle) return;

      mobileMenu.classList.remove("translate-x-0");
      mobileMenu.classList.add("translate-x-full");
      mobileMenuOverlay.classList.remove("opacity-100", "pointer-events-auto");
      mobileMenuOverlay.classList.add("opacity-0", "pointer-events-none");
      menuToggle.setAttribute("aria-expanded", "false");
      body.style.overflow = "";

      if (menuLine1 && menuLine2 && menuLine3) {
        (menuLine1 as HTMLElement).style.transform = "rotate(0) translateY(0)";
        (menuLine2 as HTMLElement).style.opacity = "1";
        (menuLine3 as HTMLElement).style.transform = "rotate(0) translateY(0)";
      }
    }

    function openMenu() {
      if (!mobileMenu || !mobileMenuOverlay || !menuToggle) return;

      mobileMenu.classList.remove("translate-x-full");
      mobileMenu.classList.add("translate-x-0");
      mobileMenuOverlay.classList.remove("opacity-0", "pointer-events-none");
      mobileMenuOverlay.classList.add("opacity-100", "pointer-events-auto");
      menuToggle.setAttribute("aria-expanded", "true");
      body.style.overflow = "hidden";

      if (menuLine1 && menuLine2 && menuLine3) {
        (menuLine1 as HTMLElement).style.transform =
          "rotate(45deg) translateY(8px)";
        (menuLine2 as HTMLElement).style.opacity = "0";
        (menuLine3 as HTMLElement).style.transform =
          "rotate(-45deg) translateY(-8px)";
      }
    }

    menuToggle.addEventListener("click", (e) => {
      e.stopPropagation();
      const isOpen = mobileMenu.classList.contains("translate-x-0");

      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    mobileMenuOverlay.addEventListener("click", closeMenu);

    if (mobileMenuClose) {
      mobileMenuClose.addEventListener("click", closeMenu);
    }

    const menuLinks = mobileMenu.querySelectorAll("a");
    menuLinks.forEach((link) => {
      link.addEventListener("click", closeMenu);
    });

    document.addEventListener("keydown", (e) => {
      if (
        e.key === "Escape" &&
        mobileMenu.classList.contains("translate-x-0")
      ) {
        closeMenu();
      }
    });

    closeMenu();
  }

  if (typeof window !== "undefined") {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initMobileMenu);
    } else {
      initMobileMenu();
    }
  }
</script>
